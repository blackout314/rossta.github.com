<!doctype html>
<html>
  <head>
    <title>Configuring Rack Test Driver in Capybara 2 | Ross Kaffenberger</title>
    <meta charset="utf-8" />
    <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="The homepage of Ross Kaffenberger.">
    <meta name="keywords" content="Ross Kaffenberger, software, software developer,
    ruby, javascript, web development, startups">
    <script type="text/javascript" src="//use.typekit.net/ned0mml.js"></script>
    <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
    <link href="/stylesheets/all.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="/images/favicon.ico" rel="icon" type="image/ico" />
  </head>
  <body id="application" class="typekit">
    <nav id="welcome" class="row">
      <section id="title" class="large-6 small-12 columns">
        <header class="signature-font">
          <h1><a class="logo" href="/">ross kaffenberger</a></h1>
        </header>
      </section>
      <section id="nav" class="large-6 small-12 columns nav">
        <ul>
  <li><a href="/projects">projects</a></li>
  <li><a href="/blog">blog</a></li>
  <li><a href="/about">about</a></li>
  <li><a href="/feed.xml">feed</a></li>
</ul>

      </section>
    </nav>
    <div id="neck">
      <div class="row">
        <div class="large-12 columns">Blog</div>
      </div>
    </div>
    <div class="row">
      <section id="main" role="main" class="large-8 small-12 columns">
          
  
  <section id="blog">
    <article class="post">
      <header>
        <h2>
          Configuring Rack Test Driver in Capybara 2
          <br /><small>Mar 26</small>
        </h2>
        
          <section class="share">
  <!-- AddThis Button BEGIN -->
  <div class="addthis_toolbox addthis_default_style" addthis:url="http://rosskaff.com/blog/2013/03/configuring-rack-test-driver-in-capybara-2.html" addthis:title="Configuring Rack Test Driver in Capybara 2">
    <a class="addthis_button_preferred_1"></a>
    <a class="addthis_button_preferred_2"></a>
    <a class="addthis_button_preferred_3"></a>
    <a class="addthis_button_preferred_4"></a>
    <a class="addthis_button_compact"></a>
    <a class="addthis_counter addthis_bubble_style"></a>
  </div>
  <script type="text/javascript">var addthis_config = {"data_track_addressbar":true};</script>
  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-52f3af16161832f9"></script>
  <!-- AddThis Button END -->  
</section>

        
      </header>
      <p>Though I don&#39;t recommend excessive redirects, sometimes you need more than 5 in your Capybara specs; this is the default redirect limit for <a href="https://github.com/jnicklas/capybara">Capybara</a>. When you exceed this limit, you get a dreaded <code>Capybara::InfiniteRedirectError</code>.</p>

<p>In Capybara 2.0+, this limit is configurable:</p>

<pre><code class="ruby">Capybara.register_driver :rack_test do |app|
  Capybara::RackTest::Driver.new app, \
    redirect_limit: 15,
    follow_redirects: true,
    respect_data_method: true
end
</code></pre>

<p>Register a new instance of the rack test driver with options, as shown above. If you&#39;re on Rails, it may be necessary for you to set <code>:respect_data_method</code> to <code>true</code>; this instructs capybara to simulate the request method specified via data-method attributes in your link. With Rails, an extension like <a href="https://github.com/rails/jquery-ujs">rails/jquery-ujs</a> allows you to enable additional request methods via unobtrusive javascript in real browsers. This setting currently defaults to false in the RackTest driver; one of the primary configurations in <a href="https://github.com/jnicklas/capybara/blob/master/lib/capybara/rails.rb"><code>capybara/rails</code></a> is to set this option. So&hellip; you may be surprised if you omit this option and suddenly get missing route exceptions in your specs.</p>

<p>The best long term solution for you and your users is to figure out how to reduce or eliminate unnecessary redirects. Playing with the redirect limit in your test environment may be a good way to identify potential problem areas of your app.</p>

    </article>
    
    <section class="comments">
      <section class="share">
  <!-- AddThis Button BEGIN -->
  <div class="addthis_toolbox addthis_default_style" addthis:url="http://rosskaff.com/blog/2013/03/configuring-rack-test-driver-in-capybara-2.html" addthis:title="Configuring Rack Test Driver in Capybara 2">
    <a class="addthis_button_preferred_1"></a>
    <a class="addthis_button_preferred_2"></a>
    <a class="addthis_button_preferred_3"></a>
    <a class="addthis_button_preferred_4"></a>
    <a class="addthis_button_compact"></a>
    <a class="addthis_counter addthis_bubble_style"></a>
  </div>
  <script type="text/javascript">var addthis_config = {"data_track_addressbar":true};</script>
  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-52f3af16161832f9"></script>
  <!-- AddThis Button END -->  
</section>

      <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname  = 'rosskaff';
    var disqus_identifier = 'configuring-rack-test-driver-in-capybara-2';
    var disqus_title      = 'Configuring Rack Test Driver in Capybara 2';
    var disqus_url        = 'http://rosskaff.com/blog/2013/03/configuring-rack-test-driver-in-capybara-2.html';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>

<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

<!-- <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a> -->

    </section>
    
  </section>

      </section>
      <section id="sidebar" role="sidebar" class="large-4 small-12 columns">
        <a href="https://twitter.com/rossta" class="twitter-follow-button" data-show-count="true">Follow @rossta</a>

<script>
!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
</script>
<section id="extras">
  <aside>
    <h6>Recent Articles</h6>
    <ul>
      
        <li>
          <a href="/blog/2014/02/ruby,-you-autocomplete-me.html">Ruby, You Autocomplete Me</a>
        </li>
      
        <li>
          <a href="/blog/2014/02/automatic-backups-to-amazon-s3-are-easy.html">Automatic Backups to Amazon S3 are Easy</a>
        </li>
      
        <li>
          <a href="/blog/2013/08/featured-post-for-speed-awareness-month.html">Featured Post for Speed Awareness Month</a>
        </li>
      
        <li>
          <a href="/blog/2013/03/configuring-rack-test-driver-in-capybara-2.html">Configuring Rack Test Driver in Capybara 2</a>
        </li>
      
        <li>
          <a href="/blog/2013/03/why-i-ditched-wordpress-for-github.html">Why I Ditched Wordpress for Github</a>
        </li>
      
    </ul>

    <h6>Tags</h6>
    <ul>
      
        <li><a href="/blog/tags/life.html">Life [4]</a></li>
      
        <li><a href="/blog/tags/code.html">Code [17]</a></li>
      
        <li><a href="/blog/tags/work.html">Work [1]</a></li>
      
    </ul>

    <h6>By Year</h6>
    <ul>
      
        <li><a href="/blog/2014.html">2014 [2]</a></li>
      
        <li><a href="/blog/2013.html">2013 [4]</a></li>
      
        <li><a href="/blog/2012.html">2012 [1]</a></li>
      
        <li><a href="/blog/2011.html">2011 [5]</a></li>
      
        <li><a href="/blog/2010.html">2010 [7]</a></li>
      
    </ul>
  </aside>

</section>

      </section>
    </div>
    <div class="row">
      <footer>
        <section class="large-12 columns center-inline-list">
          <ul class="inline-list">
  <li><a href="mailto:rosskaff@gmail.com">email</a></li>
  <li><a href="http://twitter.com/rossta">twitter</a></li>
  <li><a href="http://github.com/rossta">github</a></li>
</ul>

        </section>
      </footer>
    </div>
    <script src="/javascripts/all.js" type="text/javascript"></script>
    <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-16458563-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

  </body>
</html>
