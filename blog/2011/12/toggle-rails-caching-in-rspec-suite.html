<!doctype html>
<html>
  <head>
    <title>Ross Kaffenberger</title>
    <meta charset="utf-8" />
    <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <script type="text/javascript" src="//use.typekit.net/ned0mml.js"></script>
    <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
    <link href="/stylesheets/all.css" media="screen" rel="stylesheet" type="text/css" />
  </head>
  <body class="typekit">
    <div class="row">
      <section id="sidebar" class="large-4 columns">
        <header class="signature-font">
          <h1><a class="logo" href="/">rossta</a></h1>
          <h2><a href="/"><small>ross kaffenberger</small></a><h2>
        </header>
        <section class="info">
          <p>I make things</p>
        </section>
        <section class="nav">
          <ul class="inline-list">
  <li><a href="/blog">blog</a></li>
  <li><a href="/projects">projects</a></li>
  <li><a href="/about">about</a></li>
  <li><a href="http://twitter.com/rossta">twitter</a></li>
  <li><a href="http://github.com/rossta">github</a></li>
  <li><a href="mailto:rosskaff@gmail.com">email</a></li>
</ul>

        </section>
      </section>

      <section id="main" role="main" class="large-8 columns">
          <section id="blog">
    <article class="post">
      <h2>
        Toggle Rails Caching in RSpec Suites
        <br />
        <small>Dec 22</small>
      </h2>
      <p>A useful feature of RSpec is the ability to pass metadata to tests and suites and configure the test environment according. For example, <a href="https://github.com/jnicklas/capybara">Capybara</a> provides :js options to enable the javascript driver for a given spec. Another use case for RSpec metadata is to test the effects of Rails caching in requests.</p>

<p>The Rails test environment ships with controller caching disabled, which you might not prefer. Otherwise, it may be useful to be able to toggle it on/off during the test run. To provide an optional caching mechanism for your specs, configure an around block:</p>

<pre><code class="ruby">RSpec.configure do |config|
  config.around(:each, :caching) do |example|
    caching = ActionController::Base.perform_caching
    ActionController::Base.perform_caching = example.metadata[:caching]
    example.run
    ActionController::Base.perform_caching = caching
  end
end
</code></pre>

<p>The around block takes the RSpec example object as an argument. The block is triggered when :caching is detected as a key in an example’s metadata. The example object provides a number of methods for test introspection, allowing you to make changes before and after calling #run to execute the spec. Here, we are storing the previously set value of ActionContoller::Base.perform_caching, setting it for the local suite, and setting it back to the original value after it completes.</p>

<p>As a result, we now have a simple, explicit mechanism for introducing caching to individual specs and suites:</p>

<pre><code class="ruby">describe &quot;visit the homepage&quot;, :caching =&gt; true do
  // test cached stuff
end
</code></pre>

    </article>
    <section class="comments">
      <!-- Comments -->
    </section>
  </section>

      </section>
    </div>
    <div class="row">
      <footer class="large-12 columns">
        <ul class="inline-list">
  <li><a href="/blog">blog</a></li>
  <li><a href="/projects">projects</a></li>
  <li><a href="/about">about</a></li>
  <li><a href="http://twitter.com/rossta">twitter</a></li>
  <li><a href="http://github.com/rossta">github</a></li>
  <li><a href="mailto:rosskaff@gmail.com">email</a></li>
</ul>

      </footer>
    </div>
    <script src="/javascripts/all.js" type="text/javascript"></script>
  </body>
</html>
